<%@page import="java.util.ArrayList"%>
<%@page import="java.sql.*"%>
<%@page import="javax.sql.*"%>
<%@page import="com.connection.*" %>
<%@page import="net.sf.json.JSONArray"%>
<%@page import="net.sf.json.JSONObject"%>
<%@page import="java.util.*"%>
<%@page import="javax.servlet.http.HttpServletRequest" %>
<%@page import="javax.servlet.http.HttpSession" %>
<%@page import="com.common.*"%>
<%	
	Connection conn = null;
    ClsConnection ClsConnection=new ClsConnection();

	try{
	 	conn = ClsConnection.getMyConnection();
		Statement stmt = conn.createStatement();
		
		String year=request.getParameter("year");
		String month=request.getParameter("month");
		
		String sql=null;
		int val=0;
	
             sql=" update hr_empm m left join hr_timesheet t on m.doc_no=t.empid and t.year='"+year+"' and t.month='"+month+"' left join hr_timesheetset s on s.refno=t.date1 left join hr_timesheetset s1 on s1.refno=t.date2 left join hr_timesheetset s2 on s2.refno=t.date3 left join hr_timesheetset s3 on s3.refno=t.date4 left join hr_timesheetset s4 on s4.refno=t.date5 left join hr_timesheetset s5 on s5.refno=t.date6 left join hr_timesheetset s6 on s6.refno=t.date7 left join hr_timesheetset s7 on s7.refno=t.date8 left join hr_timesheetset s8 on s8.refno=t.date9 left join hr_timesheetset s9 on s9.refno=t.date10 left join hr_timesheetset s10 on s10.refno=t.date11 left join hr_timesheetset s11 on s11.refno=t.date12 left join hr_timesheetset s12 on s12.refno=t.date13 left join hr_timesheetset s13 on s13.refno=t.date14 left join hr_timesheetset s14 on s14.refno=t.date15 left join hr_timesheetset s15 on s15.refno=t.date16 left join hr_timesheetset s16 on s16.refno=t.date17 left join hr_timesheetset s17 on s17.refno=t.date18 left join hr_timesheetset s18 on s18.refno=t.date19 left join hr_timesheetset s19 on s19.refno=t.date20 left join hr_timesheetset s20 on s20.refno=t.date21 left join hr_timesheetset s21 on s21.refno=t.date22 left join hr_timesheetset s22 on s22.refno=t.date23 left join hr_timesheetset s23 on s23.refno=t.date24 left join hr_timesheetset s24 on s24.refno=t.date25 left join hr_timesheetset s25 on s25.refno=t.date26 left join hr_timesheetset s26 on s26.refno=t.date27 left join hr_timesheetset s27 on s27.refno=t.date28 left join hr_timesheetset s28 on s28.refno=t.date29 left join hr_timesheetset s29 on s29.refno=t.date30 left join hr_timesheetset s30 on s30.refno=t.date31 "
             + "set tot_leave1=coalesce((if(s.doc_no=1,1,0)+if(s1.doc_no=1,1,0)+if(s2.doc_no=1,1,0)+if(s3.doc_no=1,1,0)+if (s4.doc_no=1,1,0)+if(s5.doc_no=1,1,0)+if(s6.doc_no=1,1,0)+if(s7.doc_no=1,1,0)+if(s8.doc_no=1,1,0) +if(s9.doc_no=1,1,0)+if(s10.doc_no=1,1,0)+if(s11.doc_no=1,1,0)+if(s12.doc_no=1,1,0)+if(s13.doc_no=1,1,0) +if(s14.doc_no=1,1,0)+if(s15.doc_no=1,1,0)+if(s16.doc_no=1,1,0)+if(s17.doc_no=1,1,0)+if(s18.doc_no=1,1,0) +if(s19.doc_no=1,1,0)+if(s20.doc_no=1,1,0)+if(s21.doc_no=1,1,0)+if(s22.doc_no=1,1,0)+if(s23.doc_no=1,1,0)+if(s24.doc_no=1,1,0)+if(s25.doc_no=1,1,0)+if(s26.doc_no=1,1,0)+if(s27.doc_no=1,1,0)+if(s28.doc_no=1,1,0)+ if(s29.doc_no=1,1,0)+if(s30.doc_no=1,1,0))+(if(s.refno=32,0.5,0)+if(s1.refno=32,0.5,0)+if(s2.refno=32,0.5,0)+if(s3.refno=32,0.5,0)+if (s4.refno=32,0.5,0)+if(s5.refno=32,0.5,0)+if(s6.refno=32,0.5,0)+if(s7.refno=32,0.5,0)+if(s8.refno=32,0.5,0) +if(s9.refno=32,0.5,0)+if(s10.refno=32,0.5,0)+if(s11.refno=32,0.5,0)+if(s12.refno=32,0.5,0)+if(s13.refno=32,0.5,0) +if(s14.refno=32,0.5,0)+if(s5.refno=32,0.5,0)+if(s16.refno=32,0.5,0)+if(s17.refno=32,0.5,0)+if(s18.refno=32,0.5,0) +if(s19.refno=32,0.5,0)+if(s20.refno=32,0.5,0)+if(s21.refno=32,0.5,0)+if(s22.refno=32,0.5,0)+if(s23.refno=32,0.5,0)+if(s24.refno=32,0.5,0)+if(s25.refno=32,0.5,0)+if(s26.refno=32,0.5,0)+if(s27.refno=32,0.5,0)+if(s28.refno=32,0.5,0)+ if(s29.refno=32,0.5,0)+if(s30.refno=32,0.5,0)),0), "
             + "tot_leave2=coalesce((if(s.doc_no=2,1,0)+if(s1.doc_no=2,1,0)+if(s2.doc_no=2,1,0)+if(s3.doc_no=2,1,0)+if (s4.doc_no=2,1,0)+if(s5.doc_no=2,1,0)+if(s6.doc_no=2,1,0)+if(s7.doc_no=2,1,0)+if(s8.doc_no=2,1,0) +if(s9.doc_no=2,1,0)+if(s10.doc_no=2,1,0)+if(s11.doc_no=2,1,0)+if(s12.doc_no=2,1,0)+if(s13.doc_no=2,1,0) +if(s14.doc_no=2,1,0)+if(s15.doc_no=2,1,0)+if(s16.doc_no=2,1,0)+if(s17.doc_no=2,1,0)+if(s18.doc_no=2,1,0) +if(s19.doc_no=2,1,0)+if(s20.doc_no=2,1,0)+if(s21.doc_no=2,1,0)+if(s22.doc_no=2,1,0)+if(s23.doc_no=2,1,0)+if(s24.doc_no=2,1,0)+if(s25.doc_no=2,1,0)+if(s26.doc_no=2,1,0)+if(s27.doc_no=2,1,0)+if(s28.doc_no=2,1,0)+ if(s29.doc_no=2,1,0)+if(s30.doc_no=2,1,0))+(if(s.refno=42,0.5,0)+if(s1.refno=42,0.5,0)+if(s2.refno=42,0.5,0)+if(s3.refno=42,0.5,0)+if (s4.refno=42,0.5,0)+if(s5.refno=42,0.5,0)+if(s6.refno=42,0.5,0)+if(s7.refno=42,0.5,0)+if(s8.refno=42,0.5,0) +if(s9.refno=42,0.5,0)+if(s10.refno=42,0.5,0)+if(s11.refno=42,0.5,0)+if(s12.refno=42,0.5,0)+if(s13.refno=42,0.5,0) +if(s14.refno=42,0.5,0)+if(s5.refno=42,0.5,0)+if(s16.refno=42,0.5,0)+if(s17.refno=42,0.5,0)+if(s18.refno=42,0.5,0) +if(s19.refno=42,0.5,0)+if(s20.refno=42,0.5,0)+if(s21.refno=42,0.5,0)+if(s22.refno=42,0.5,0)+if(s23.refno=42,0.5,0)+if(s24.refno=42,0.5,0)+if(s25.refno=42,0.5,0)+if(s26.refno=42,0.5,0)+if(s27.refno=42,0.5,0)+if(s28.refno=42,0.5,0)+ if(s29.refno=42,0.5,0)+if(s30.refno=42,0.5,0)),0), "
             + "tot_leave3=coalesce((if(s.doc_no=3,1,0)+if(s1.doc_no=3,1,0)+if(s2.doc_no=3,1,0)+if(s3.doc_no=3,1,0)+if (s4.doc_no=3,1,0)+if(s5.doc_no=3,1,0)+if(s6.doc_no=3,1,0)+if(s7.doc_no=3,1,0)+if(s8.doc_no=3,1,0) +if(s9.doc_no=3,1,0)+if(s10.doc_no=3,1,0)+if(s11.doc_no=3,1,0)+if(s12.doc_no=3,1,0)+if(s13.doc_no=3,1,0) +if(s14.doc_no=3,1,0)+if(s15.doc_no=3,1,0)+if(s16.doc_no=3,1,0)+if(s17.doc_no=3,1,0)+if(s18.doc_no=3,1,0) +if(s19.doc_no=3,1,0)+if(s20.doc_no=3,1,0)+if(s21.doc_no=3,1,0)+if(s22.doc_no=3,1,0)+if(s23.doc_no=3,1,0)+if(s24.doc_no=3,1,0)+if(s25.doc_no=3,1,0)+if(s26.doc_no=3,1,0)+if(s27.doc_no=3,1,0)+if(s28.doc_no=3,1,0)+ if(s29.doc_no=3,1,0)+if(s30.doc_no=3,1,0))+(if(s.refno=52,0.5,0)+if(s1.refno=52,0.5,0)+if(s2.refno=52,0.5,0)+if(s3.refno=52,0.5,0)+if (s4.refno=52,0.5,0)+if(s5.refno=52,0.5,0)+if(s6.refno=52,0.5,0)+if(s7.refno=52,0.5,0)+if(s8.refno=52,0.5,0) +if(s9.refno=52,0.5,0)+if(s10.refno=52,0.5,0)+if(s11.refno=52,0.5,0)+if(s12.refno=52,0.5,0)+if(s13.refno=52,0.5,0) +if(s14.refno=52,0.5,0)+if(s5.refno=52,0.5,0)+if(s16.refno=52,0.5,0)+if(s17.refno=52,0.5,0)+if(s18.refno=52,0.5,0) +if(s19.refno=52,0.5,0)+if(s20.refno=52,0.5,0)+if(s21.refno=52,0.5,0)+if(s22.refno=52,0.5,0)+if(s23.refno=52,0.5,0)+if(s24.refno=52,0.5,0)+if(s25.refno=52,0.5,0)+if(s26.refno=52,0.5,0)+if(s27.refno=52,0.5,0)+if(s28.refno=52,0.5,0)+ if(s29.refno=52,0.5,0)+if(s30.refno=52,0.5,0)),0) , "
             + "tot_leave4=coalesce((if(s.doc_no=4,1,0)+if(s1.doc_no=4,1,0)+if(s2.doc_no=4,1,0)+if(s3.doc_no=4,1,0)+if (s4.doc_no=4,1,0)+if(s5.doc_no=4,1,0)+if(s6.doc_no=4,1,0)+if(s7.doc_no=4,1,0)+if(s8.doc_no=4,1,0) +if(s9.doc_no=4,1,0)+if(s10.doc_no=4,1,0)+if(s11.doc_no=4,1,0)+if(s12.doc_no=4,1,0)+if(s13.doc_no=4,1,0) +if(s14.doc_no=4,1,0)+if(s15.doc_no=4,1,0)+if(s16.doc_no=4,1,0)+if(s17.doc_no=4,1,0)+if(s18.doc_no=4,1,0) +if(s19.doc_no=4,1,0)+if(s20.doc_no=4,1,0)+if(s21.doc_no=4,1,0)+if(s22.doc_no=4,1,0)+if(s23.doc_no=4,1,0)+if(s24.doc_no=4,1,0)+if(s25.doc_no=4,1,0)+if(s26.doc_no=4,1,0)+if(s27.doc_no=4,1,0)+if(s28.doc_no=4,1,0)+ if(s29.doc_no=4,1,0)+if(s30.doc_no=4,1,0))+(if(s.refno=62,0.5,0)+if(s1.refno=62,0.5,0)+if(s2.refno=62,0.5,0)+if(s3.refno=62,0.5,0)+if (s4.refno=62,0.5,0)+if(s5.refno=62,0.5,0)+if(s6.refno=62,0.5,0)+if(s7.refno=62,0.5,0)+if(s8.refno=62,0.5,0) +if(s9.refno=62,0.5,0)+if(s10.refno=62,0.5,0)+if(s11.refno=62,0.5,0)+if(s12.refno=62,0.5,0)+if(s13.refno=62,0.5,0) +if(s14.refno=62,0.5,0)+if(s5.refno=62,0.5,0)+if(s16.refno=62,0.5,0)+if(s17.refno=62,0.5,0)+if(s18.refno=62,0.5,0) +if(s19.refno=62,0.5,0)+if(s20.refno=62,0.5,0)+if(s21.refno=62,0.5,0)+if(s22.refno=62,0.5,0)+if(s23.refno=62,0.5,0)+if(s24.refno=62,0.5,0)+if(s25.refno=62,0.5,0)+if(s26.refno=62,0.5,0)+if(s27.refno=62,0.5,0)+if(s28.refno=62,0.5,0)+ if(s29.refno=62,0.5,0)+if(s30.refno=62,0.5,0)),0), "
             + "tot_leave5=coalesce((if(s.doc_no=5,1,0)+if(s1.doc_no=5,1,0)+if(s2.doc_no=5,1,0)+if(s3.doc_no=5,1,0)+if (s4.doc_no=5,1,0)+if(s5.doc_no=5,1,0)+if(s6.doc_no=5,1,0)+if(s7.doc_no=5,1,0)+if(s8.doc_no=5,1,0) +if(s9.doc_no=5,1,0)+if(s10.doc_no=5,1,0)+if(s11.doc_no=5,1,0)+if(s12.doc_no=5,1,0)+if(s13.doc_no=5,1,0) +if(s14.doc_no=5,1,0)+if(s15.doc_no=5,1,0)+if(s16.doc_no=5,1,0)+if(s17.doc_no=5,1,0)+if(s18.doc_no=5,1,0) +if(s19.doc_no=5,1,0)+if(s20.doc_no=5,1,0)+if(s21.doc_no=5,1,0)+if(s22.doc_no=5,1,0)+if(s23.doc_no=5,1,0)+if(s24.doc_no=5,1,0)+if(s25.doc_no=5,1,0)+if(s26.doc_no=5,1,0)+if(s27.doc_no=5,1,0)+if(s28.doc_no=5,1,0)+ if(s29.doc_no=5,1,0)+if(s30.doc_no=5,1,0))+(if(s.refno=72,0.5,0)+if(s1.refno=72,0.5,0)+if(s2.refno=72,0.5,0)+if(s3.refno=72,0.5,0)+if (s4.refno=72,0.5,0)+if(s5.refno=72,0.5,0)+if(s6.refno=72,0.5,0)+if(s7.refno=72,0.5,0)+if(s8.refno=72,0.5,0) +if(s9.refno=72,0.5,0)+if(s10.refno=72,0.5,0)+if(s11.refno=72,0.5,0)+if(s12.refno=72,0.5,0)+if(s13.refno=72,0.5,0) +if(s14.refno=72,0.5,0)+if(s5.refno=72,0.5,0)+if(s16.refno=72,0.5,0)+if(s17.refno=72,0.5,0)+if(s18.refno=72,0.5,0) +if(s19.refno=72,0.5,0)+if(s20.refno=72,0.5,0)+if(s21.refno=72,0.5,0)+if(s22.refno=72,0.5,0)+if(s23.refno=72,0.5,0)+if(s24.refno=72,0.5,0)+if(s25.refno=72,0.5,0)+if(s26.refno=72,0.5,0)+if(s27.refno=72,0.5,0)+if(s28.refno=72,0.5,0)+ if(s29.refno=72,0.5,0)+if(s30.refno=72,0.5,0)),0), "
             + "tot_leave6=coalesce((if(s.doc_no=6,1,0)+if(s1.doc_no=6,1,0)+if(s2.doc_no=6,1,0)+if(s3.doc_no=6,1,0)+if (s4.doc_no=6,1,0)+if(s5.doc_no=6,1,0)+if(s6.doc_no=6,1,0)+if(s7.doc_no=6,1,0)+if(s8.doc_no=6,1,0) +if(s9.doc_no=6,1,0)+if(s10.doc_no=6,1,0)+if(s11.doc_no=6,1,0)+if(s12.doc_no=6,1,0)+if(s13.doc_no=6,1,0) +if(s14.doc_no=6,1,0)+if(s15.doc_no=6,1,0)+if(s16.doc_no=6,1,0)+if(s17.doc_no=6,1,0)+if(s18.doc_no=6,1,0) +if(s19.doc_no=6,1,0)+if(s20.doc_no=6,1,0)+if(s21.doc_no=6,1,0)+if(s22.doc_no=6,1,0)+if(s23.doc_no=6,1,0)+if(s24.doc_no=6,1,0)+if(s25.doc_no=6,1,0)+if(s26.doc_no=6,1,0)+if(s27.doc_no=6,1,0)+if(s28.doc_no=6,1,0)+ if(s29.doc_no=6,1,0)+if(s30.doc_no=6,1,0))+(if(s.refno=82,0.5,0)+if(s1.refno=82,0.5,0)+if(s2.refno=82,0.5,0)+if(s3.refno=82,0.5,0)+if (s4.refno=82,0.5,0)+if(s5.refno=82,0.5,0)+if(s6.refno=82,0.5,0)+if(s7.refno=82,0.5,0)+if(s8.refno=82,0.5,0) +if(s9.refno=82,0.5,0)+if(s10.refno=82,0.5,0)+if(s11.refno=82,0.5,0)+if(s12.refno=82,0.5,0)+if(s13.refno=82,0.5,0) +if(s14.refno=82,0.5,0)+if(s5.refno=82,0.5,0)+if(s16.refno=82,0.5,0)+if(s17.refno=82,0.5,0)+if(s18.refno=82,0.5,0) +if(s19.refno=82,0.5,0)+if(s20.refno=82,0.5,0)+if(s21.refno=82,0.5,0)+if(s22.refno=82,0.5,0)+if(s23.refno=82,0.5,0)+if(s24.refno=82,0.5,0)+if(s25.refno=82,0.5,0)+if(s26.refno=82,0.5,0)+if(s27.refno=82,0.5,0)+if(s28.refno=82,0.5,0)+ if(s29.refno=82,0.5,0)+if(s30.refno=82,0.5,0)),0), "
             + "tot_leave7=coalesce((if(s.doc_no=7,1,0)+if(s1.doc_no=7,1,0)+if(s2.doc_no=7,1,0)+if(s3.doc_no=7,1,0)+if (s4.doc_no=7,1,0)+if(s5.doc_no=7,1,0)+if(s6.doc_no=7,1,0)+if(s7.doc_no=7,1,0)+if(s8.doc_no=7,1,0) +if(s9.doc_no=7,1,0)+if(s10.doc_no=7,1,0)+if(s11.doc_no=7,1,0)+if(s12.doc_no=7,1,0)+if(s13.doc_no=7,1,0) +if(s14.doc_no=7,1,0)+if(s15.doc_no=7,1,0)+if(s16.doc_no=7,1,0)+if(s17.doc_no=7,1,0)+if(s18.doc_no=7,1,0) +if(s19.doc_no=7,1,0)+if(s20.doc_no=7,1,0)+if(s21.doc_no=7,1,0)+if(s22.doc_no=7,1,0)+if(s23.doc_no=7,1,0)+if(s24.doc_no=7,1,0)+if(s25.doc_no=7,1,0)+if(s26.doc_no=7,1,0)+if(s27.doc_no=7,1,0)+if(s28.doc_no=7,1,0)+ if(s29.doc_no=7,1,0)+if(s30.doc_no=7,1,0))+(if(s.refno=102,0.5,0)+if(s1.refno=102,0.5,0)+if(s2.refno=102,0.5,0)+if(s3.refno=102,0.5,0)+if (s4.refno=102,0.5,0)+if(s5.refno=102,0.5,0)+if(s6.refno=102,0.5,0)+if(s7.refno=102,0.5,0)+if(s8.refno=102,0.5,0) +if(s9.refno=102,0.5,0)+if(s10.refno=102,0.5,0)+if(s11.refno=102,0.5,0)+if(s12.refno=102,0.5,0)+if(s13.refno=102,0.5,0) +if(s14.refno=102,0.5,0)+if(s5.refno=102,0.5,0)+if(s16.refno=102,0.5,0)+if(s17.refno=102,0.5,0)+if(s18.refno=102,0.5,0) +if(s19.refno=102,0.5,0)+if(s20.refno=102,0.5,0)+if(s21.refno=102,0.5,0)+if(s22.refno=102,0.5,0)+if(s23.refno=102,0.5,0)+if(s24.refno=102,0.5,0)+if(s25.refno=102,0.5,0)+if(s26.refno=102,0.5,0)+if(s27.refno=102,0.5,0)+if(s28.refno=102,0.5,0)+ if(s29.refno=102,0.5,0)+if(s30.refno=102,0.5,0)),0), "
             + "tot_ot=t.tot_ot,tot_hot=t.tot_hot where m.status=3 "; 
			
 
 
        //  System.out.println("update val sql ="+sql); 
			val= stmt.executeUpdate(sql);
			
		
		response.getWriter().print(val);

	 	stmt.close();
	 	conn.close();
	}catch(Exception e){
	 	e.printStackTrace();
	 	conn.close();
   }finally{
	   conn.close();
   }
	
%>
